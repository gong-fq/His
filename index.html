
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronos: 英国历史探索 - 龚凤乾教授设计</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;700&family=Inter:wght@400;600&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .serif { font-family: 'Crimson Pro', serif; }
        .bilingual-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        @media (max-width: 768px) { .bilingual-grid { grid-template-columns: 1fr; } }
        .play-btn { transition: all 0.2s; cursor: pointer; border-radius: 50%; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; background: rgba(59, 130, 246, 0.1); }
        .play-btn.playing { background: #22c55e; color: white; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .chat-window { box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .chat-messages { scrollbar-width: thin; scrollbar-color: #cbd5e1 #f1f5f9; }
        .chat-messages::-webkit-scrollbar { width: 6px; }
        .chat-messages::-webkit-scrollbar-track { background: #f1f5f9; }
        .chat-messages::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // 完整的13个时代数据，包含详细内容（修复乱码问题）
        const ERAS = [
            { 
                id: 'pre-roman', 
                name: '史前与凯尔特', 
                enName: 'Pre-Roman & Celtic', 
                year: 'Before AD 43', 
                quickIntro: { 
                    zh: "史前时期的英国是不列颠文明的曙光，以巨石阵和凯尔特部落文明闻名。", 
                    en: "Pre-Roman Britain marks the dawn of civilization, famous for Stonehenge and Celtic tribes." 
                },
                detailedContent: {
                    zh: "不列颠群岛的史前时期始于旧石器时代晚期，持续到公元43年罗马入侵。这一时期最重要的考古遗迹是位于威尔特郡的巨石阵（Stonehenge），建于公元前3000年至公元前2000年之间。凯尔特人约在公元前800年至公元前600年期间从欧洲大陆迁徙而来，带来了铁器时代文化。凯尔特社会以部落为基础，由德鲁伊教祭司统治，拥有复杂的艺术风格和神话体系。他们建造了山堡（hillforts）作为防御和居住中心,其中梅登城堡（Maiden Castle）是最大的铁器时代山堡之一。",
                    en: "The prehistoric period of the British Isles began in the late Paleolithic era and lasted until the Roman invasion in AD 43. The most significant archaeological site from this era is Stonehenge in Wiltshire, constructed between 3000 and 2000 BCE. Celtic peoples migrated from continental Europe around 800-600 BCE, bringing Iron Age culture. Celtic society was tribal, ruled by Druid priests, with complex artistic styles and mythology. They built hillforts like Maiden Castle, one of the largest Iron Age hillforts, as defensive and residential centers."
                },
                sources: [{ name: "British Museum", url: "https://www.britishmuseum.org" }, { name: "English Heritage", url: "https://www.english-heritage.org.uk" }] 
            },
            { 
                id: 'roman', 
                name: '罗马统治时期', 
                enName: 'Roman Britain', 
                year: 'AD 43 - 410', 
                quickIntro: { 
                    zh: "罗马人带来了城市、道路和法律。哈德良长城是这一时期的重要遗迹。", 
                    en: "Romans introduced cities, roads, and laws. Hadrian's Wall remains a key landmark." 
                },
                detailedContent: {
                    zh: "公元43年，罗马皇帝克劳狄乌斯派遣四万大军入侵不列颠，开始了近四百年的罗马统治。罗马人建立了伦敦（Londinium）、约克（Eboracum）和巴斯（Aquae Sulis）等城市，并修建了超过8000英里的道路网络。哈德良长城（Hadrian's Wall）建于公元122-128年，横跨英格兰北部，全长73英里，是罗马帝国最北端的防线。罗马不列颠时期，不列颠逐渐罗马化，接受了拉丁语、罗马法律和行政管理体系。基督教在公元4世纪传入。公元410年，罗马军队撤离，结束了罗马在不列颠的统治。",
                    en: "In AD 43, Emperor Claudius sent 40,000 troops to invade Britain, beginning nearly 400 years of Roman rule. Romans established cities like Londinium (London), Eboracum (York), and Aquae Sulis (Bath), building over 8,000 miles of roads. Hadrian's Wall, constructed AD 122-128, spanned 73 miles across northern England as the empire's northern frontier. Britain became Romanized, adopting Latin, Roman law, and administration. Christianity arrived in the 4th century. Roman troops withdrew in AD 410, ending Roman Britain."
                },
                sources: [{ name: "Roman Britain Org", url: "https://www.roman-britain.co.uk" }, { name: "Historic UK", url: "https://www.historic-uk.com" }] 
            },
            { 
                id: 'anglo-saxon', 
                name: '盎格鲁-撒克逊', 
                enName: 'Anglo-Saxon Era', 
                year: '410 - 1066', 
                quickIntro: { 
                    zh: "罗马撤军后，日耳曼部落定居于此，形成了早期英格兰王国的雏形。", 
                    en: "After Romans left, Germanic tribes settled, forming the early kingdoms of England." 
                },
                detailedContent: {
                    zh: "罗马军队撤离后，来自日德兰半岛和德国北部的盎格鲁-撒克逊人入侵并定居不列颠。这一时期形成了七个主要王国：肯特、东盎格利亚、诺森布里亚、麦西亚、埃塞克斯、萨塞克斯和威塞克斯，史称'七国时代'。基督教在圣奥古斯丁于597年抵达肯特后重新传入。盎格鲁-撒克逊时期见证了英语的早期发展、史诗《贝奥武夫》的创作以及阿尔弗雷德大帝（871-899年在位）对维京人入侵的抵抗。1066年的黑斯廷斯战役中，盎格鲁-撒克逊国王哈罗德二世被诺曼征服者威廉击败，结束了这个时代。",
                    en: "After Roman withdrawal, Angles, Saxons, and Jutes from Jutland and northern Germany invaded and settled in Britain. This period saw the formation of seven major kingdoms: Kent, East Anglia, Northumbria, Mercia, Essex, Sussex, and Wessex—the 'Heptarchy'. Christianity was reintroduced with St. Augustine's arrival in Kent in 597. The Anglo-Saxon era witnessed early development of the English language, composition of the epic 'Beowulf', and King Alfred the Great's (r. 871-899) resistance against Viking invasions. The Battle of Hastings in 1066, where Anglo-Saxon King Harold II was defeated by Norman conqueror William, ended this era."
                },
                sources: [{ name: "British Library", url: "https://www.bl.uk/anglo-saxons" }] 
            },
            { 
                id: 'medieval', 
                name: '中世纪盛期', 
                enName: 'The Middle Ages', 
                year: '1066 - 1485', 
                quickIntro: { 
                    zh: "从诺曼征服到玫瑰战争，这是一个骑士、领主和大宪章的时代。", 
                    en: "From the Norman Conquest to the Wars of the Roses, an age of knights and Magna Carta." 
                },
                detailedContent: {
                    zh: "诺曼征服后，威廉一世建立了封建制度，建造了伦敦塔和白塔等城堡。1215年，贵族强迫约翰王签署《大宪章》（Magna Carta），限制了王权，奠定了英国法治基础。中世纪见证了百年战争（1337-1453年）与法国争夺领土，以及黑死病（1348-1349年）造成人口减半。玫瑰战争（1455-1487年）是约克家族和兰开斯特家族之间的内战，最终亨利·都铎获胜，建立都铎王朝。这一时期哥特式建筑盛行，坎特伯雷大教堂和威斯敏斯特教堂得以扩建。",
                    en: "After the Norman Conquest, William I established feudalism, constructing castles like the Tower of London's White Tower. In 1215, nobles forced King John to sign Magna Carta, limiting royal power and laying foundations for English common law. The Middle Ages witnessed the Hundred Years' War (1337-1453) against France and the Black Death (1348-1349) halving the population. The Wars of the Roses (1455-1487) were civil wars between Houses of York and Lancaster, ending with Henry Tudor's victory and establishment of the Tudor dynasty. Gothic architecture flourished with expansions to Canterbury Cathedral and Westminster Abbey."
                },
                sources: [{ name: "National Archives", url: "https://www.nationalarchives.gov.uk" }, { name: "Magna Carta @ BL", url: "https://www.bl.uk/magna-carta" }] 
            },
            { 
                id: 'tudor', 
                name: '都铎王朝', 
                enName: 'The Tudors', 
                year: '1485 - 1603', 
                quickIntro: { 
                    zh: "亨利八世与伊丽莎白一世的黄金时代，见证了宗教改革和海外扩张。", 
                    en: "The golden age of Henry VIII and Elizabeth I, seeing the Reformation and expansion." 
                },
                detailedContent: {
                    zh: "都铎王朝始于亨利·都铎（亨利七世）在博斯沃思战役中获胜。亨利八世（1509-1547年在位）因离婚问题与罗马教廷决裂，创立英国国教会，解散修道院。他的女儿伊丽莎白一世（1558-1603年在位）时期是英国文艺复兴的黄金时代，见证了莎士比亚的戏剧、弗朗西斯·德雷克的环球航行以及1588年击败西班牙无敌舰队。这一时期英国开始海外殖民，建立了第一个北美殖民地（罗阿诺克，1585年）。印刷术的引入促进了知识的传播。",
                    en: "The Tudor dynasty began with Henry Tudor's (Henry VII) victory at Bosworth Field. Henry VIII (r. 1509-1547) broke with Rome over divorce, establishing the Church of England and dissolving monasteries. His daughter Elizabeth I's reign (1558-1603) was a golden age of English Renaissance, witnessing Shakespeare's plays, Francis Drake's circumnavigation, and defeat of the Spanish Armada in 1588. England began overseas colonization with the first North American colony (Roanoke, 1585). The printing press spread knowledge widely."
                },
                sources: [{ name: "Historic Royal Palaces", url: "https://www.hrp.org.uk" }, { name: "Tudor History", url: "https://www.tudorhistory.org" }] 
            },
            { 
                id: 'stuart', 
                name: '斯图亚特王朝', 
                enName: 'The Stuarts', 
                year: '1603 - 1714', 
                quickIntro: { 
                    zh: "内战、共和国和光荣革命塑造了现代议会制度。", 
                    en: "Civil War, Republic, and Glorious Revolution shaped modern parliamentary democracy." 
                },
                detailedContent: {
                    zh: "斯图亚特王朝始于詹姆斯一世，他统一了英格兰和苏格兰王冠。查理一世（1625-1649年在位）与议会的冲突导致了英国内战（1642-1651年）。奥利弗·克伦威尔领导的议会军击败了保王党，查理一世被处决，英国成为共和国（1649-1660年）。王政复辟后，詹姆斯二世的天主教倾向引发了1688年的光荣革命，威廉三世和玛丽二世联合即位，确立了议会至上原则。1707年《联合法案》正式合并英格兰和苏格兰，建立大不列颠王国。",
                    en: "The Stuart period began with James I, unifying the English and Scottish crowns. Charles I's (r. 1625-1649) conflict with Parliament led to the English Civil War (1642-1651). Oliver Cromwell's Parliamentary forces defeated the Royalists, Charles I was executed, and England became a Commonwealth (1649-1660). After the Restoration, James II's Catholic leanings triggered the Glorious Revolution of 1688, with William III and Mary II's joint accession establishing parliamentary supremacy. The 1707 Acts of Union formally merged England and Scotland, creating Great Britain."
                },
                sources: [{ name: "Parliament UK History", url: "https://www.parliament.uk/about/living-heritage" }] 
            },
            { 
                id: 'georgian', 
                name: '乔治王朝', 
                enName: 'Georgian Era', 
                year: '1714 - 1837', 
                quickIntro: { 
                    zh: "启蒙运动、工业革命和帝国扩张的时代。", 
                    en: "An era of Enlightenment, Industrial Revolution, and imperial expansion." 
                },
                detailedContent: {
                    zh: "乔治王朝时期见证了英国从农业社会向工业社会的转型。工业革命（约1760-1840年）始于纺织业机械化和蒸气机的发明。英国在七年战争（1756-1763年）后成为全球主导的殖民帝国，但在美国独立战争（1775-1783年）中失去了13个北美殖民地。拿破仑战争期间，纳尔逊在特拉法加海战（1805年）和威灵顿在滑铁卢战役（1815年）中的胜利巩固了英国的欧洲地位。这一时期也是英国建筑、文学和音乐的黄金时代，简·奥斯汀、华兹华斯等文学巨匠辈出。",
                    en: "The Georgian era witnessed Britain's transformation from agricultural to industrial society. The Industrial Revolution (c. 1760-1840) began with mechanization of textiles and invention of the steam engine. Britain became the dominant colonial power after the Seven Years' War (1756-1763) but lost 13 North American colonies in the American Revolution (1775-1783). During the Napoleonic Wars, victories at Trafalgar (1805) by Nelson and Waterloo (1815) by Wellington secured Britain's European position. This was also a golden age of British architecture, literature, and music, producing literary giants like Jane Austen and Wordsworth."
                },
                sources: [{ name: "Georgian Group", url: "https://www.georgiangroup.org.uk" }] 
            },
            { 
                id: 'victorian', 
                name: '维多利亚时代', 
                enName: 'Victorian Era', 
                year: '1837 - 1901', 
                quickIntro: { 
                    zh: "大英帝国的巅峰，见证了科技进步和社会改革。", 
                    en: "The height of the British Empire, witnessing technological progress and social reform." 
                },
                detailedContent: {
                    zh: "维多利亚女王统治的64年是英国历史上最繁荣的时期之一。大英帝国达到顶峰，控制了全球四分之一的土地和人口。1851年的万国工业博览会展示了英国的工业实力。铁路网络扩展，电报和电话发明，蒸汽轮船缩短了全球距离。狄更斯的小说反映了社会不平等，推动了工厂法、教育改革和公共卫生改善。达尔文的《物种起源》（1859年）革新了科学思想。这一时期也见证了苏伊士运河的控制和南非布尔战争（1899-1902年）。",
                    en: "Queen Victoria's 64-year reign was one of Britain's most prosperous periods. The British Empire reached its zenith, controlling a quarter of the world's land and population. The Great Exhibition of 1851 showcased British industrial might. Railway networks expanded, telegraph and telephone were invented, and steamships shortened global distances. Dickens' novels reflected social inequality, driving Factory Acts, education reform, and public health improvements. Darwin's 'Origin of Species' (1859) revolutionized scientific thought. This era also saw control of the Suez Canal and the Boer War (1899-1902) in South Africa."
                },
                sources: [{ name: "Victoria & Albert Museum", url: "https://www.vam.ac.uk" }] 
            },
            { 
                id: 'edwardian', 
                name: '爱德华时代', 
                enName: 'Edwardian Period', 
                year: '1901 - 1914', 
                quickIntro: { 
                    zh: "短暂的繁荣与优雅，第一次世界大战前夕的平静。", 
                    en: "Brief prosperity and elegance, the calm before World War I." 
                },
                detailedContent: {
                    zh: "爱德华七世在位期间（1901-1910年）是英国社会相对宽松和文化繁荣的时期。这一时期被称为'拉贝拉时代'（La Belle Époque），特点是社会阶级分明但充满乐观情绪。妇女选举权运动加剧，艾米琳·潘克赫斯特领导的激进抗议活动推动了改革。爱尔兰自治问题成为政治焦点。工党的崛起挑战了传统的两党制。科技进步继续，飞机、汽车和电影院开始普及。然而，国际紧张局势加剧，欧洲大国之间的联盟体系最终导致了1914年第一次世界大战的爆发。",
                    en: "Edward VII's reign (1901-1910) was a period of relative social relaxation and cultural prosperity. Known as the 'La Belle Époque', it was characterized by distinct social classes yet optimistic spirit. The women's suffrage movement intensified, with Emmeline Pankhurst's militant protests driving reform. Irish Home Rule became a political focus. The Labour Party's rise challenged the traditional two-party system. Technological progress continued with aeroplanes, automobiles, and cinemas becoming widespread. However, international tensions escalated, and the alliance system among European powers ultimately led to World War I's outbreak in 1914."
                },
                sources: [{ name: "Imperial War Museums", url: "https://www.iwm.org.uk" }] 
            },
            { 
                id: 'world-wars', 
                name: '两次世界大战', 
                enName: 'The World Wars', 
                year: '1914 - 1945', 
                quickIntro: { 
                    zh: "两场全球冲突重塑了世界秩序和英国的国际地位。", 
                    en: "Two global conflicts reshaped world order and Britain's international standing." 
                },
                detailedContent: {
                    zh: "第一次世界大战（1914-1918年）导致近百万英国人丧生，索姆河战役和帕斯尚尔战役成为惨烈战争的象征。战后《凡尔赛条约》重绘了欧洲版图。两次大战之间的时期经历了经济萧条和政治动荡。第二次世界大战（1939-1945年）中，丘吉尔领导英国抵抗纳粹德国。敦刻尔克大撤退、不列颠空战和诺曼底登陆是关键时刻。战争结束时，英国虽然胜利但经济疲惫，帝国开始瓦解，印度在1947年独立标志着去殖民化时代的开始。",
                    en: "World War I (1914-1918) cost nearly a million British lives, with battles of the Somme and Passchendaele symbolizing the carnage. The Treaty of Versailles redrew Europe's map. The interwar period saw economic depression and political turmoil. In World War II (1939-1945), Churchill led Britain's resistance against Nazi Germany. Dunkirk evacuation, Battle of Britain, and D-Day Normandy landing were pivotal moments. Though victorious, Britain emerged economically exhausted, with the Empire beginning to dissolve. India's independence in 1947 marked the start of decolonization."
                },
                sources: [{ name: "Imperial War Museums", url: "https://www.iwm.org.uk" }, { name: "Churchill Archives", url: "https://www.churchillarchive.com" }] 
            },
            { 
                id: 'post-war', 
                name: '战后重建', 
                enName: 'Post-War Period', 
                year: '1945 - 1979', 
                quickIntro: { 
                    zh: "福利国家建立、去殖民化和社会变革的时代。", 
                    en: "Era of welfare state creation, decolonization, and social transformation." 
                },
                detailedContent: {
                    zh: "1945年工党政府建立了国民健康服务体系（NHS）和现代福利国家。英国经历了大规模去殖民化，失去了大部分海外领土，但建立了英联邦。1950年代和1960年代见证了经济复苏、消费主义兴起和'摇摆的六十年代'文化革命，甲壳虫乐队和滚石乐队成为全球文化偶像。移民增加，特别是来自加勒比海和南亚的移民，改变了英国社会构成。1973年英国加入欧洲经济共同体。1970年代经济滞胀、罢工潮和石油危机导致政治不稳定，为撒切尔时代铺平了道路。",
                    en: "The 1945 Labour government established the National Health Service (NHS) and modern welfare state. Britain underwent massive decolonization, losing most overseas territories while forming the Commonwealth. The 1950s-60s saw economic recovery, rise of consumerism, and the 'Swinging Sixties' cultural revolution, with The Beatles and Rolling Stones becoming global icons. Immigration increased, particularly from the Caribbean and South Asia, transforming British society. Britain joined the European Economic Community in 1973. The 1970s' stagflation, strikes, and oil crisis caused political instability, paving the way for the Thatcher era."
                },
                sources: [{ name: "National Archives", url: "https://www.nationalarchives.gov.uk" }] 
            },
            { 
                id: 'thatcher-major', 
                name: '撒切尔与梅杰时代', 
                enName: 'Thatcher & Major Years', 
                year: '1979 - 1997', 
                quickIntro: { 
                    zh: "新自由主义经济改革和冷战结束重塑了英国。", 
                    en: "Neoliberal economic reforms and the Cold War's end reshaped Britain." 
                },
                detailedContent: {
                    zh: "玛格丽特·撒切尔（1979-1990年）推行激进的自由市场改革，私有化国有企业，削弱工会力量，降低税收。1982年福克兰战争增强了她的政治地位。撒切尔与里根和戈尔巴乔夫合作，在冷战结束中发挥了作用。然而，人头税引发了大规模抗议，导致她辞职。约翰·梅杰（1990-1997年）签署了《马斯特里赫特条约》，将英国更深入地融入欧盟，但欧洲问题分裂了保守党。这一时期经济增长与社会不平等加剧并存，金融服务业崛起，而传统制造业衰退。",
                    en: "Margaret Thatcher (1979-1990) implemented radical free-market reforms, privatizing state enterprises, weakening unions, and cutting taxes. The 1982 Falklands War strengthened her political position. Thatcher worked with Reagan and Gorbachev, playing a role in ending the Cold War. However, the poll tax sparked mass protests, leading to her resignation. John Major (1990-1997) signed the Maastricht Treaty, integrating Britain deeper into the EU, though European issues divided the Conservatives. This period saw economic growth alongside widening inequality, with financial services rising and traditional manufacturing declining."
                },
                sources: [{ name: "Margaret Thatcher Foundation", url: "https://www.margaretthatcher.org" }] 
            },
            { 
                id: 'new-labour', 
                name: '新工党时代', 
                enName: 'New Labour Era', 
                year: '1997 - 2010', 
                quickIntro: { 
                    zh: "托尼·布莱尔的'第三条道路'和权力下放改革。", 
                    en: "Tony Blair's 'Third Way' and devolution reforms." 
                },
                detailedContent: {
                    zh: "托尼·布莱尔领导的新工党以压倒性优势赢得1997年大选，标志着政治转变。布莱尔推行'第三条道路'，结合市场经济与社会正义。重大改革包括苏格兰和威尔士权力下放（1998年），上议院改革和最低工资引入。英国参与科索沃战争和阿富汗战争，但2003年伊拉克战争引发了巨大争议，损害了布莱尔的声誉。戈登·布朗（2007-2010年）在2008年全球金融危机期间担任首相，英国银行业需要政府救助，随后实施紧缩政策。",
                    en: "Tony Blair's New Labour won the 1997 election by a landslide, marking a political shift. Blair pursued a 'Third Way', combining market economics with social justice. Major reforms included devolution for Scotland and Wales (1998), House of Lords reform, and introducing the minimum wage. Britain participated in Kosovo and Afghanistan wars, but the 2003 Iraq War was highly controversial, damaging Blair's reputation. Gordon Brown (2007-2010) led during the 2008 global financial crisis, requiring government bailouts for British banks and subsequent austerity measures."
                },
                sources: [{ name: "The Blair Years Archive", url: "https://www.gov.uk" }] 
            },
            { 
                id: 'modern', 
                name: '当代英国', 
                enName: 'Modern Britain', 
                year: '2010 - Present', 
                quickIntro: { 
                    zh: "脱欧、政治动荡和身份认同的重新定义。", 
                    en: "Brexit, political upheaval, and redefinition of national identity." 
                },
                detailedContent: {
                    zh: "2010年保守党-自由民主党联合政府实施紧缩政策应对财政赤字。2014年苏格兰独立公投以55%对45%拒绝独立。2016年脱欧公投以52%对48%支持离开欧盟，引发了持续的政治危机。特蕾莎·梅和鲍里斯·约翰逊先后担任首相，努力完成脱欧。英国于2020年1月31日正式离开欧盟。COVID-19疫情（2020-2022年）造成了重大健康和经济影响。2022年伊丽莎白二世去世后，查理三世继位。当代英国面临经济挑战、社会分化和气候变化等问题，同时努力在后脱欧时代重新定位自己的全球角色。",
                    en: "The 2010 Conservative-Liberal Democrat coalition implemented austerity to address the fiscal deficit. The 2014 Scottish independence referendum rejected independence 55% to 45%. The 2016 Brexit referendum voted 52% to 48% to leave the EU, triggering ongoing political crisis. Theresa May and Boris Johnson successively served as PM, working to deliver Brexit. Britain formally left the EU on January 31, 2020. The COVID-19 pandemic (2020-2022) caused major health and economic impacts. Charles III succeeded after Queen Elizabeth II's death in 2022. Modern Britain faces economic challenges, social divisions, and climate change while redefining its global role post-Brexit."
                },
                sources: [{ name: "UK Government", url: "https://www.gov.uk" }, { name: "BBC News", url: "https://www.bbc.com/news" }] 
            }
        ];

        // AI聊天组件 - 使用 DeepSeek API
        const ChatWidget = ({ currentEra }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const sendMessage = async () => {
                if (!input.trim() || isLoading) return;

                const userMessage = { role: 'user', content: input };
                setMessages(prev => [...prev, userMessage]);
                setInput('');
                setIsLoading(true);

                try {
                    // 调用 Netlify Function
                    const response = await fetch('/.netlify/functions/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            messages: [...messages, userMessage],
                            currentEra: {
                                name: currentEra.name,
                                enName: currentEra.enName,
                                year: currentEra.year
                            }
                        })
                    });

                    const data = await response.json();
                    
                    if (response.ok) {
                        const assistantMessage = {
                            role: 'assistant',
                            content: data.message
                        };
                        setMessages(prev => [...prev, assistantMessage]);
                    } else {
                        throw new Error(data.error || '请求失败');
                    }
                } catch (error) {
                    console.error('Chat error:', error);
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: '抱歉，我暂时无法回答。请检查网络连接或稍后再试。'
                    }]);
                }

                setIsLoading(false);
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            return (
                <>
                    {/* 聊天按钮 */}
                    <button
                        onClick={() => setIsOpen(!isOpen)}
                        className="fixed bottom-6 right-6 w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-all flex items-center justify-center z-50 hover:scale-110"
                    >
                        <i className={`fas ${isOpen ? 'fa-times' : 'fa-comments'} text-xl`}></i>
                    </button>

                    {/* 聊天窗口 */}
                    {isOpen && (
                        <div className="fixed bottom-24 right-6 w-96 h-[500px] bg-white rounded-2xl chat-window flex flex-col z-50">
                            {/* 头部 */}
                            <div className="bg-blue-600 text-white p-4 rounded-t-2xl flex items-center gap-3">
                                <i className="fas fa-robot text-2xl"></i>
                                <div>
                                    <div className="font-bold">历史助手</div>
                                    <div className="text-xs opacity-90">有关英国历史的任何问题</div>
                                </div>
                            </div>

                            {/* 消息区域 */}
                            <div className="flex-1 overflow-y-auto p-4 chat-messages">
                                {messages.length === 0 && (
                                    <div className="text-center text-slate-400 mt-8">
                                        <i className="fas fa-comments text-4xl mb-3"></i>
                                        <p className="text-sm">您好！我可以帮您解答关于<br/><strong>{currentEra.name}</strong>的问题。</p>
                                    </div>
                                )}
                                {messages.map((msg, idx) => (
                                    <div key={idx} className={`mb-3 ${msg.role === 'user' ? 'text-right' : 'text-left'}`}>
                                        <div className={`inline-block max-w-[80%] p-3 rounded-2xl ${
                                            msg.role === 'user' 
                                                ? 'bg-blue-600 text-white' 
                                                : 'bg-slate-100 text-slate-800'
                                        }`}>
                                            <p className="text-sm whitespace-pre-wrap">{msg.content}</p>
                                        </div>
                                    </div>
                                ))}
                                {isLoading && (
                                    <div className="text-left mb-3">
                                        <div className="inline-block bg-slate-100 p-3 rounded-2xl">
                                            <i className="fas fa-circle-notch fa-spin text-slate-400"></i>
                                        </div>
                                    </div>
                                )}
                                <div ref={messagesEndRef} />
                            </div>

                            {/* 输入区域 */}
                            <div className="p-4 border-t border-slate-200">
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        value={input}
                                        onChange={(e) => setInput(e.target.value)}
                                        onKeyPress={handleKeyPress}
                                        placeholder="输入您的问题..."
                                        className="flex-1 px-4 py-2 border border-slate-300 rounded-full focus:outline-none focus:border-blue-500"
                                        disabled={isLoading}
                                    />
                                    <button
                                        onClick={sendMessage}
                                        disabled={isLoading || !input.trim()}
                                        className="w-10 h-10 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                                    >
                                        <i className="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        };

        const App = () => {
            const [currentEraId, setCurrentEraId] = useState('pre-roman');
            const [showDetailed, setShowDetailed] = useState(false);
            const [isLoading, setIsLoading] = useState(false);
            const [isSpeechSupported, setIsSpeechSupported] = useState(false);
            const [speaking, setSpeaking] = useState({ zh: false, en: false });

            useEffect(() => {
                setIsSpeechSupported('speechSynthesis' in window);
            }, []);

            const currentEra = ERAS.find(era => era.id === currentEraId);
            const content = showDetailed ? currentEra.detailedContent : currentEra.quickIntro;

            const getMoreDetails = () => {
                if (!showDetailed) {
                    setIsLoading(true);
                    setTimeout(() => {
                        setShowDetailed(true);
                        setIsLoading(false);
                    }, 1200);
                }
            };

            const resetToQuickIntro = () => {
                setShowDetailed(false);
            };

            const speak = (text, lang) => {
                if (!isSpeechSupported) return;
                if (speaking[lang]) {
                    window.speechSynthesis.cancel();
                    setSpeaking(prev => ({ ...prev, [lang]: false }));
                } else {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = lang === 'zh' ? 'zh-CN' : 'en-GB';
                    utterance.rate = 0.9;
                    utterance.onstart = () => setSpeaking(prev => ({ ...prev, [lang]: true }));
                    utterance.onend = () => setSpeaking(prev => ({ ...prev, [lang]: false }));
                    window.speechSynthesis.speak(utterance);
                }
            };

            return (
                <div className="flex">
                    <aside className="w-72 bg-slate-900 text-white fixed h-screen overflow-y-auto">
                        <div className="p-8 border-b border-slate-700">
                            <h2 className="text-3xl font-black serif mb-2">Chronos</h2>
                            <p className="text-sm text-slate-400">英国历史时代探索</p>
                            <p className="text-xs text-slate-500 mt-2">龚凤乾教授 设计</p>
                        </div>
                        <nav className="p-4">
                            {ERAS.map(era => (
                                <button
                                    key={era.id}
                                    onClick={() => { setCurrentEraId(era.id); setShowDetailed(false); }}
                                    className={`w-full text-left p-4 mb-2 rounded-xl transition-all ${currentEra.id === era.id ? 'bg-blue-600 shadow-lg scale-105' : 'bg-slate-800 hover:bg-slate-700'}`}
                                >
                                    <div className="text-sm font-bold">{era.enName}</div>
                                    <div className="text-[11px] opacity-60">{era.name}</div>
                                </button>
                            ))}
                        </nav>
                    </aside>

                    <main className="ml-72 flex-1 p-10 bg-white min-h-screen">
                        <header className="mb-10 flex justify-between items-end border-b pb-8">
                            <div>
                                <h1 className="text-5xl font-black serif text-slate-900 mb-2 tracking-tight">{currentEra.enName}</h1>
                                <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-bold tracking-tighter">{currentEra.year}</span>
                            </div>
                            <div className="flex gap-4">
                                {showDetailed && (
                                    <button onClick={resetToQuickIntro} className="flex items-center gap-2 px-6 py-3 rounded-full font-bold bg-slate-200 text-slate-700 hover:bg-slate-300 transition-all active:scale-95">
                                        <i className="fas fa-history"></i>
                                        返回简介
                                    </button>
                                )}
                                <button onClick={getMoreDetails} disabled={isLoading} className={`flex items-center gap-2 px-6 py-3 rounded-full font-bold transition-all ${isLoading ? 'bg-slate-100 text-slate-400' : 'bg-blue-600 text-white hover:bg-blue-700 shadow-xl active:scale-95'}`}>
                                    <i className={`fas ${isLoading ? 'fa-circle-notch fa-spin' : 'fa-feather-alt'}`}></i>
                                    {isLoading ? "史官翻阅卷宗..." : showDetailed ? "已获取深度内容" : "获取深度史料解析"}
                                </button>
                            </div>
                        </header>

                        {showDetailed && (
                            <div className="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                                <div className="flex items-center gap-2 text-green-700">
                                    <i className="fas fa-check-circle"></i>
                                    <span className="font-bold">深度内容已加载</span>
                                    <span className="text-sm">点击"返回简介"按钮查看简短版本</span>
                                </div>
                            </div>
                        )}

                        <div className="bilingual-grid mb-12">
                            <div className="p-8 bg-slate-50 rounded-2xl relative border border-slate-100">
                                <div className="flex justify-between items-center mb-6">
                                    <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest italic">
                                        {showDetailed ? "深度解析 (中文)" : "双语简介 (中文)"}
                                    </span>
                                    <div className="flex items-center gap-2">
                                        {!isSpeechSupported && (
                                            <span className="text-xs text-red-500">语音不可用</span>
                                        )}
                                        <button 
                                            onClick={() => speak(content.zh, 'zh')} 
                                            className={`play-btn ${speaking.zh ? 'playing' : ''}`}
                                            disabled={!isSpeechSupported}
                                        >
                                            <i className="fas fa-volume-up text-lg"></i>
                                        </button>
                                    </div>
                                </div>
                                <p className="text-lg leading-relaxed text-slate-800">{content.zh}</p>
                            </div>
                            <div className="p-8 bg-blue-50/50 rounded-2xl relative border border-blue-100">
                                <div className="flex justify-between items-center mb-6">
                                    <span className="text-[10px] font-bold text-blue-400 uppercase tracking-widest italic">
                                        {showDetailed ? "In-Depth Analysis (English)" : "Bilingual Context (English)"}
                                    </span>
                                    <div className="flex items-center gap-2">
                                        {!isSpeechSupported && (
                                            <span className="text-xs text-red-500">Voice Unavailable</span>
                                        )}
                                        <button 
                                            onClick={() => speak(content.en, 'en')} 
                                            className={`play-btn ${speaking.en ? 'playing' : ''}`}
                                            disabled={!isSpeechSupported}
                                        >
                                            <i className="fas fa-volume-up text-lg"></i>
                                        </button>
                                    </div>
                                </div>
                                <p className="text-xl leading-relaxed serif italic text-slate-700">{content.en}</p>
                            </div>
                        </div>

                        <section className="bg-slate-50 p-6 rounded-xl border border-dashed border-slate-200">
                            <h3 className="text-xs font-bold text-slate-500 uppercase tracking-[0.2em] mb-4 flex items-center gap-2">
                                <i className="fas fa-landmark"></i> 龚教授推荐：权威参考文献与在线资源
                            </h3>
                            <div className="flex flex-wrap gap-3">
                                {currentEra.sources.map((source, idx) => (
                                    <a key={idx} href={source.url} target="_blank" className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-lg text-sm font-semibold text-slate-600 hover:border-blue-500 hover:text-blue-600 transition-all hover:shadow-md">
                                        <i className="fas fa-external-link-alt text-[10px] opacity-40"></i> {source.name}
                                    </a>
                                ))}
                            </div>
                        </section>
                    </main>

                    {/* AI聊天组件 */}
                    <ChatWidget currentEra={currentEra} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
